import { Subject, BehaviorSubject } from 'rxjs';
import { Settings } from './utils';
export class TableData {
    // TODO refactor
    constructor(columns, options) {
        this._nextObservable = new Subject();
        this._previousObservable = new Subject();
        this._sizeObservable = new Subject();
        this._sortObservable = new Subject();
        this._columns = new BehaviorSubject(columns.map(c => { if (c.isActive === undefined) {
            c.isActive = true;
        } return c; }));
        if (options) {
            if (options.pageSizeOptions && options.pageSizeOptions.length < 1) {
                throw Error('Array of pageSizeOptions must contain at least one entry');
            }
            if (options.defaultSortParams) {
                options.defaultSortParams.map(s => {
                    if (!this._displayedColumns.includes(s)) {
                        throw Error(`Provided sort parameter "${s}" is not a column.`);
                    }
                });
            }
            this._sortParams = options.defaultSortParams || [];
            this._sortDirs = options.defaultSortDirs || [];
            if (this._sortParams.length !== this._sortDirs.length) {
                this._sortDirs = this._sortParams.map(() => 'asc');
            }
            this._totalElements = options.totalElements || 0;
            this._pageSizeOptions = options.pageSizeOptions || [10, 20, 50, 100];
            this._key = options.localStorageKey;
        }
        else {
            this._pageSizeOptions = [10, 20, 50, 100];
            this._sortParams = [];
            this._sortDirs = [];
        }
        this.pageSize = this._pageSizeOptions[0];
        this.init();
        this._displayedColumns = this._columns.value.filter(c => c.isActive).map(c => c.id);
    }
    onSortEvent() {
        this._sortParams = this._dataSource.sort['actives'];
        this._sortDirs = this._dataSource.sort['directions'];
        this._clientSideSort();
        this._sortObservable.next();
        this.storeTableSettings();
    }
    onPaginationEvent($event) {
        const tmpPageSize = this.pageSize;
        this.pageSize = $event.pageSize;
        this.pageIndex = $event.pageIndex;
        if (tmpPageSize !== this.pageSize) {
            this._sizeObservable.next();
        }
        else if ($event.previousPageIndex < $event.pageIndex) {
            this._nextObservable.next();
        }
        else if ($event.previousPageIndex > $event.pageIndex) {
            this._previousObservable.next();
        }
    }
    updateSortHeaders() {
        // Dirty hack to display default sort column(s)
        const temp = Object.assign([], this._displayedColumns);
        this._displayedColumns = [];
        setTimeout(() => this._displayedColumns = temp, 0);
        this._clientSideSort();
        this._sortObservable.next();
        this.storeTableSettings();
        1;
    }
    init() {
        console.debug("init");
        if (this._key) {
            const settings = new Settings(this._key);
            settings.load();
            if (this._isLocalStorageSettingsValid(settings)) {
                this.columns = settings.columns;
                this._sortDirs = settings.sortDirs;
                this._sortParams = settings.sortParams;
            }
            else {
                console.warn("Stored tableSettings are invalid. Using default");
            }
        }
    }
    _clientSideSort() {
        this._dataSource.orderData();
    }
    _isLocalStorageSettingsValid(settings) {
        // check if number of columns matching
        if (settings.columns.length !== this._columns.value.length) {
            return false;
        }
        // check if columns are the same
        for (var column of settings.columns) {
            var match = this._columns.value.filter(c => c.id == column.id && c.name == column.name);
            if (match === undefined) {
                return false;
            }
        }
        return true;
    }
    storeTableSettings() {
        console.log("Store");
        if (this._key) {
            const settings = new Settings(this._key);
            settings.columns = this._columns.value;
            settings.sortParams = this._sortParams;
            settings.sortDirs = this._sortDirs;
            settings.save();
        }
    }
    set totalElements(totalElements) {
        this._totalElements = totalElements;
    }
    get totalElements() {
        return this._totalElements;
    }
    set displayedColumns(displayedColumns) {
        this._displayedColumns = displayedColumns;
    }
    get displayedColumns() {
        return this._displayedColumns;
    }
    set dataSource(dataSource) {
        this._dataSource = dataSource;
        if (this._sortParams.length > 0) {
            this._dataSource.sort.actives = this._sortParams;
            this._dataSource.sort.directions = this._sortDirs.map(v => v);
            this.updateSortHeaders();
        }
    }
    get dataSource() {
        return this._dataSource;
    }
    set data(data) {
        this._dataSource.data = data;
        this._clientSideSort();
    }
    set columns(v) {
        this._columns.next(v.map(c => { if (c.isActive === undefined) {
            c.isActive = true;
        } return c; }));
    }
    onColumnsChange() {
        return this._columns;
    }
    updateColumnNames(v) {
        const dict = {};
        v.forEach(c => dict[c.id] = c.name);
        this._columns.next(this._columns.value.map(c => { c.name = dict[c.id] || c.name; return c; }));
    }
    get nextObservable() {
        return this._nextObservable;
    }
    get previousObservable() {
        return this._previousObservable;
    }
    get sizeObservable() {
        return this._sizeObservable;
    }
    get sortObservable() {
        return this._sortObservable;
    }
    get sortParams() {
        return this._sortParams;
    }
    get sortDirs() {
        return this._sortDirs;
    }
    get columns() {
        return this._columns.value;
    }
    get pageSizeOptions() {
        return this._pageSizeOptions;
    }
    set sortParams(v) {
        this._sortParams = v;
        this._dataSource.sort.actives = this._sortParams;
    }
    set sortDirs(v) {
        this._sortDirs = v;
        this._dataSource.sort.directions = this._sortDirs.map(elem => elem);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFibGUtZGF0YS5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLi8uLi9wcm9qZWN0cy9tYXQtbXVsdGktc29ydC9zcmMvIiwic291cmNlcyI6WyJsaWIvdGFibGUtZGF0YS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUloRCxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBRW5DLE1BQU0sT0FBTyxTQUFTO0lBa0JsQixnQkFBZ0I7SUFDaEIsWUFBWSxPQUEyRCxFQUNuRSxPQU1DO1FBZEcsb0JBQWUsR0FBa0IsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUNyRCx3QkFBbUIsR0FBa0IsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUN6RCxvQkFBZSxHQUFrQixJQUFJLE9BQU8sRUFBUSxDQUFDO1FBQ3JELG9CQUFlLEdBQWtCLElBQUksT0FBTyxFQUFRLENBQUM7UUFZekQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLGVBQWUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUMsUUFBUSxLQUFLLFNBQVMsRUFBRTtZQUFFLENBQUMsQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO1NBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFMUgsSUFBSSxPQUFPLEVBQUU7WUFDVCxJQUFJLE9BQU8sQ0FBQyxlQUFlLElBQUksT0FBTyxDQUFDLGVBQWUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUMvRCxNQUFNLEtBQUssQ0FBQywwREFBMEQsQ0FBQyxDQUFDO2FBQzNFO1lBRUQsSUFBSSxPQUFPLENBQUMsaUJBQWlCLEVBQUU7Z0JBQzNCLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUU7b0JBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMs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LENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztJQUNyRCxDQUFDO0lBRUQsSUFBVyxRQUFRLENBQUMsQ0FBVztRQUMzQixJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQztRQUNuQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFxQixDQUFDLENBQUM7SUFDekYsQ0FBQztDQUNKIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3ViamVjdCwgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IE1hdE11bHRpU29ydFRhYmxlRGF0YVNvdXJjZSB9IGZyb20gJy4vbWF0LW11bHRpLXNvcnQtZGF0YS1zb3VyY2UnO1xyXG5pbXBvcnQgeyBQYWdlRXZlbnQgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9wYWdpbmF0b3InO1xyXG5pbXBvcnQgeyBTb3J0RGlyZWN0aW9uIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvc29ydCc7XHJcbmltcG9ydCB7IFNldHRpbmdzIH0gZnJvbSAnLi91dGlscyc7XHJcblxyXG5leHBvcnQgY2xhc3MgVGFibGVEYXRhPFQ+IHtcclxuICAgIHByaXZhdGUgX2RhdGFTb3VyY2U6IE1hdE11bHRpU29ydFRhYmxlRGF0YVNvdXJjZTxUPjtcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgX2NvbHVtbnM6IEJlaGF2aW9yU3ViamVjdDx7IGlkOiBzdHJpbmcsIG5hbWU6IHN0cmluZywgaXNBY3RpdmU/OiBib29sZWFuIH1bXT47XHJcbiAgICBwcml2YXRlIF9kaXNwbGF5ZWRDb2x1bW5zOiBzdHJpbmdbXTtcclxuICAgIHBhZ2VTaXplOiBudW1iZXI7XHJcbiAgICBwYWdlSW5kZXg6IG51bWJlcjtcclxuICAgIHByaXZhdGUgX3BhZ2VTaXplT3B0aW9uczogbnVtYmVyW107XHJcbiAgICBwcml2YXRlIF90b3RhbEVsZW1lbnRzOiBudW1iZXI7XHJcbiAgICBwcml2YXRlIF9zb3J0UGFyYW1zOiBzdHJpbmdbXTtcclxuICAgIHByaXZhdGUgX3NvcnREaXJzOiBzdHJpbmdbXTtcclxuICAgIHByaXZhdGUgX2tleTogc3RyaW5nO1xyXG5cclxuICAgIHByaXZhdGUgX25leHRPYnNlcnZhYmxlOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcclxuICAgIHByaXZhdGUgX3ByZXZpb3VzT2JzZXJ2YWJsZTogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XHJcbiAgICBwcml2YXRlIF9zaXplT2JzZXJ2YWJsZTogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XHJcbiAgICBwcml2YXRlIF9zb3J0T2JzZXJ2YWJsZTogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0PHZvaWQ+KCk7XHJcblxyXG5cclxuICAgIC8vIFRPRE8gcmVmYWN0b3JcclxuICAgIGNvbnN0cnVjdG9yKGNvbHVtbnM6IHsgaWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBpc0FjdGl2ZT86IGJvb2xlYW4gfVtdLFxyXG4gICAgICAgIG9wdGlvbnM/OiB7XHJcbiAgICAgICAgICAgIGRlZmF1bHRTb3J0UGFyYW1zPzogc3RyaW5nW10sXHJcbiAgICAgICAgICAgIGRlZmF1bHRTb3J0RGlycz86IHN0cmluZ1tdLFxyXG4gICAgICAgICAgICBwYWdlU2l6ZU9wdGlvbnM/OiBudW1iZXJbXSxcclxuICAgICAgICAgICAgdG90YWxFbGVtZW50cz86IG51bWJlcixcclxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlS2V5Pzogc3RyaW5nXHJcbiAgICAgICAgfSkge1xyXG4gICAgICAgIHRoaXMuX2NvbHVtbnMgPSBuZXcgQmVoYXZpb3JTdWJqZWN0KGNvbHVtbnMubWFwKGMgPT4geyBpZiAoYy5pc0FjdGl2ZSA9PT0gdW5kZWZpbmVkKSB7IGMuaXNBY3RpdmUgPSB0cnVlOyB9IHJldHVybiBjOyB9KSk7XHJcblxyXG4gICAgICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgICAgIGlmIChvcHRpb25zLnBhZ2VTaXplT3B0aW9ucyAmJiBvcHRpb25zLnBhZ2VTaXplT3B0aW9ucy5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcignQXJyYXkgb2YgcGFnZVNpemVPcHRpb25zIG11c3QgY29udGFpbiBhdCBsZWFzdCBvbmUgZW50cnknKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKG9wdGlvbnMuZGVmYXVsdFNvcnRQYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgIG9wdGlvbnMuZGVmYXVsdFNvcnRQYXJhbXMubWFwKHMgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fZGlzcGxheWVkQ29sdW1ucy5pbmNsdWRlcyhzKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihgUHJvdmlkZWQgc29ydCBwYXJhbWV0ZXIgXCIke3N9XCIgaXMgbm90IGEgY29sdW1uLmApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB0aGlzLl9zb3J0UGFyYW1zID0gb3B0aW9ucy5kZWZhdWx0U29ydFBhcmFtcyB8fCBbXTtcclxuICAgICAgICAgICAgdGhpcy5fc29ydERpcnMgPSBvcHRpb25zLmRlZmF1bHRTb3J0RGlycyB8fCBbXTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9zb3J0UGFyYW1zLmxlbmd0aCAhPT0gdGhpcy5fc29ydERpcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zb3J0RGlycyA9IHRoaXMuX3NvcnRQYXJhbXMubWFwKCgpID0+ICdhc2MnKTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdGhpcy5fdG90YWxFbGVtZW50cyA9IG9wdGlvbnMudG90YWxFbGVtZW50cyB8fCAwO1xyXG4gICAgICAgICAgICB0aGlzLl9wYWdlU2l6ZU9wdGlvbnMgPSBvcHRpb25zLnBhZ2VTaXplT3B0aW9ucyB8fCBbMTAsIDIwLCA1MCwgMTAwXTtcclxuICAgICAgICAgICAgdGhpcy5fa2V5ID0gb3B0aW9ucy5sb2NhbFN0b3JhZ2VLZXk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5fcGFnZVNpemVPcHRpb25zID0gWzEwLCAyMCwgNTAsIDEwMF07XHJcbiAgICAgICAgICAgIHRoaXMuX3NvcnRQYXJhbXMgPSBbXTtcclxuICAgICAgICAgICAgdGhpcy5fc29ydERpcnMgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5wYWdlU2l6ZSA9IHRoaXMuX3BhZ2VTaXplT3B0aW9uc1swXTtcclxuXHJcbiAgICAgICAgdGhpcy5pbml0KCk7XHJcbiAgICAgICAgdGhpcy5fZGlzcGxheWVkQ29sdW1ucyA9IHRoaXMuX2NvbHVtbnMudmFsdWUuZmlsdGVyKGMgPT4gYy5pc0FjdGl2ZSkubWFwKGMgPT4gYy5pZCk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBvblNvcnRFdmVudCgpIHtcclxuICAgICAgICB0aGlzLl9zb3J0UGFyYW1zID0gdGhpcy5fZGF0YVNvdXJjZS5zb3J0WydhY3RpdmVzJ107XHJcbiAgICAgICAgdGhpcy5fc29ydERpcnMgPSB0aGlzLl9kYXRhU291cmNlLnNvcnRbJ2RpcmVjdGlvbnMnXTtcclxuICAgICAgICB0aGlzLl9jbGllbnRTaWRlU29ydCgpO1xyXG4gICAgICAgIHRoaXMuX3NvcnRPYnNlcnZhYmxlLm5leHQoKTtcclxuICAgICAgICB0aGlzLnN0b3JlVGFibGVTZXR0aW5ncygpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBvblBhZ2luYXRpb25FdmVudCgkZXZlbnQ6IFBhZ2VFdmVudCkge1xyXG4gICAgICAgIGNvbnN0IHRtcFBhZ2VTaXplOiBudW1iZXIgPSB0aGlzLnBhZ2VTaXplO1xyXG4gICAgICAgIHRoaXMucGFnZVNpemUgPSAkZXZlbnQucGFnZVNpemU7XHJcbiAgICAgICAgdGhpcy5wYWdlSW5kZXggPSAkZXZlbnQucGFnZUluZGV4O1xyXG5cclxuICAgICAgICBpZiAodG1wUGFnZVNpemUgIT09IHRoaXMucGFnZVNpemUpIHtcclxuICAgICAgICAgICAgdGhpcy5fc2l6ZU9ic2VydmFibGUubmV4dCgpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoJGV2ZW50LnByZXZpb3VzUGFnZUluZGV4IDwgJGV2ZW50LnBhZ2VJbmRleCkge1xyXG4gICAgICAgICAgICB0aGlzLl9uZXh0T2JzZXJ2YWJsZS5uZXh0KCk7XHJcbiAgICAgICAgfSBlbHNlIGlmICgkZXZlbnQucHJldmlvdXNQYWdlSW5kZXggPiAkZXZlbnQucGFnZUluZGV4KSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3ByZXZpb3VzT2JzZXJ2YWJsZS5uZXh0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB1cGRhdGVTb3J0SGVhZGVycygpOiB2b2lkIHtcclxuICAgICAgICAvLyBEaXJ0eSBoYWNrIHRvIGRpc3BsYXkgZGVmYXVsdCBzb3J0IGNvbHVtbihzKVxyXG4gICAgICAgIGNvbnN0IHRlbXAgPSBPYmplY3QuYXNzaWduKFtdLCB0aGlzLl9kaXNwbGF5ZWRDb2x1bW5zKTtcclxuICAgICAgICB0aGlzLl9kaXNwbGF5ZWRDb2x1bW5zID0gW107XHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLl9kaXNwbGF5ZWRDb2x1bW5zID0gdGVtcCwgMCk7XHJcbiAgICAgICAgdGhpcy5fY2xpZW50U2lkZVNvcnQoKTtcclxuICAgICAgICB0aGlzLl9zb3J0T2JzZXJ2YWJsZS5uZXh0KCk7XHJcbiAgICAgICAgdGhpcy5zdG9yZVRhYmxlU2V0dGluZ3MoKTsxXHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBpbml0KCkge1xyXG4gICAgICAgIGNvbnNvbGUuZGVidWcoXCJpbml0XCIpO1xyXG4gICAgICAgIGlmICh0aGlzLl9rZXkpIHtcclxuICAgICAgICAgICAgY29uc3Qgc2V0dGluZ3MgPSBuZXcgU2V0dGluZ3ModGhpcy5fa2V5KTtcclxuICAgICAgICAgICAgc2V0dGluZ3MubG9hZCgpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5faXNMb2NhbFN0b3JhZ2VTZXR0aW5nc1ZhbGlkKHNldHRpbmdzKSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb2x1bW5zID0gc2V0dGluZ3MuY29sdW1ucztcclxuICAgICAgICAgICAgICAgIHRoaXMuX3NvcnREaXJzID0gc2V0dGluZ3Muc29ydERpcnM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9zb3J0UGFyYW1zID0gc2V0dGluZ3Muc29ydFBhcmFtcztcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihcIlN0b3JlZCB0YWJsZVNldHRpbmdzIGFyZSBpbnZhbGlkLiBVc2luZyBkZWZhdWx0XCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2NsaWVudFNpZGVTb3J0KCkge1xyXG4gICAgICAgIHRoaXMuX2RhdGFTb3VyY2Uub3JkZXJEYXRhKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfaXNMb2NhbFN0b3JhZ2VTZXR0aW5nc1ZhbGlkKHNldHRpbmdzOiBTZXR0aW5ncyk6IGJvb2xlYW4ge1xyXG4gICAgICAgIC8vIGNoZWNrIGlmIG51bWJlciBvZiBjb2x1bW5zIG1hdGNoaW5nXHJcbiAgICAgICAgaWYgKHNldHRpbmdzLmNvbHVtbnMubGVuZ3RoICE9PSB0aGlzLl9jb2x1bW5zLnZhbHVlLmxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBjaGVjayBpZiBjb2x1bW5zIGFyZSB0aGUgc2FtZVxyXG4gICAgICAgIGZvciAodmFyIGNvbHVtbiBvZiBzZXR0aW5ncy5jb2x1bW5zKSB7XHJcbiAgICAgICAgICAgIHZhciBtYXRjaCA9IHRoaXMuX2NvbHVtbnMudmFsdWUuZmlsdGVyKGMgPT4gYy5pZCA9PSBjb2x1bW4uaWQgJiYgYy5uYW1lID09IGNvbHVtbi5uYW1lKTtcclxuICAgICAgICAgICAgaWYgKG1hdGNoID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc3RvcmVUYWJsZVNldHRpbmdzKCk6IHZvaWQge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiU3RvcmVcIilcclxuICAgICAgICBpZiAodGhpcy5fa2V5KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNldHRpbmdzOiBTZXR0aW5ncyA9IG5ldyBTZXR0aW5ncyh0aGlzLl9rZXkpO1xyXG4gICAgICAgICAgICBzZXR0aW5ncy5jb2x1bW5zID0gdGhpcy5fY29sdW1ucy52YWx1ZTtcclxuICAgICAgICAgICAgc2V0dGluZ3Muc29ydFBhcmFtcyA9IHRoaXMuX3NvcnRQYXJhbXM7XHJcbiAgICAgICAgICAgIHNldHRpbmdzLnNvcnREaXJzID0gdGhpcy5fc29ydERpcnM7XHJcbiAgICAgICAgICAgIHNldHRpbmdzLnNhdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldCB0b3RhbEVsZW1lbnRzKHRvdGFsRWxlbWVudHM6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuX3RvdGFsRWxlbWVudHMgPSB0b3RhbEVsZW1lbnRzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQgdG90YWxFbGVtZW50cygpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90b3RhbEVsZW1lbnRzO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXQgZGlzcGxheWVkQ29sdW1ucyhkaXNwbGF5ZWRDb2x1bW5zOiBzdHJpbmdbXSkge1xyXG4gICAgICAgIHRoaXMuX2Rpc3BsYXllZENvbHVtbnMgPSBkaXNwbGF5ZWRDb2x1bW5zO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQgZGlzcGxheWVkQ29sdW1ucygpOiBzdHJpbmdbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Rpc3BsYXllZENvbHVtbnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldCBkYXRhU291cmNlKGRhdGFTb3VyY2U6IE1hdE11bHRpU29ydFRhYmxlRGF0YVNvdXJjZTxUPikge1xyXG4gICAgICAgIHRoaXMuX2RhdGFTb3VyY2UgPSBkYXRhU291cmNlO1xyXG4gICAgICAgIGlmICh0aGlzLl9zb3J0UGFyYW1zLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5fZGF0YVNvdXJjZS5zb3J0LmFjdGl2ZXMgPSB0aGlzLl9zb3J0UGFyYW1zO1xyXG4gICAgICAgICAgICB0aGlzLl9kYXRhU291cmNlLnNvcnQuZGlyZWN0aW9ucyA9IHRoaXMuX3NvcnREaXJzLm1hcCh2ID0+IHYgYXMgU29ydERpcmVjdGlvbik7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlU29ydEhlYWRlcnMoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBkYXRhU291cmNlKCk6IE1hdE11bHRpU29ydFRhYmxlRGF0YVNvdXJjZTxUPiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGFTb3VyY2U7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldCBkYXRhKGRhdGE6IFRbXSkge1xyXG4gICAgICAgIHRoaXMuX2RhdGFTb3VyY2UuZGF0YSA9IGRhdGE7XHJcbiAgICAgICAgdGhpcy5fY2xpZW50U2lkZVNvcnQoKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0IGNvbHVtbnModjogeyBpZDogc3RyaW5nLCBuYW1lOiBzdHJpbmcsIGlzQWN0aXZlPzogYm9vbGVhbiB9W10pIHtcclxuICAgICAgICB0aGlzLl9jb2x1bW5zLm5leHQodi5tYXAoYyA9PiB7IGlmIChjLmlzQWN0aXZlID09PSB1bmRlZmluZWQpIHsgYy5pc0FjdGl2ZSA9IHRydWU7IH0gcmV0dXJuIGM7IH0pKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgb25Db2x1bW5zQ2hhbmdlKCk6IEJlaGF2aW9yU3ViamVjdDx7IGlkOiBzdHJpbmcsIG5hbWU6IHN0cmluZywgaXNBY3RpdmU/OiBib29sZWFuIH1bXT4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9jb2x1bW5zO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB1cGRhdGVDb2x1bW5OYW1lcyh2OiB7IGlkOiBzdHJpbmcsIG5hbWU6IHN0cmluZyB9W10pIHtcclxuICAgICAgICBjb25zdCBkaWN0ID0ge307XHJcbiAgICAgICAgdi5mb3JFYWNoKGMgPT4gZGljdFtjLmlkXSA9IGMubmFtZSk7XHJcbiAgICAgICAgdGhpcy5fY29sdW1ucy5uZXh0KHRoaXMuX2NvbHVtbnMudmFsdWUubWFwKGMgPT4geyBjLm5hbWUgPSBkaWN0W2MuaWRdIHx8IGMubmFtZTsgcmV0dXJuIGM7IH0pKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IG5leHRPYnNlcnZhYmxlKCk6IFN1YmplY3Q8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX25leHRPYnNlcnZhYmxlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQgcHJldmlvdXNPYnNlcnZhYmxlKCk6IFN1YmplY3Q8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3ByZXZpb3VzT2JzZXJ2YWJsZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IHNpemVPYnNlcnZhYmxlKCk6IFN1YmplY3Q8YW55PiB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NpemVPYnNlcnZhYmxlO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXQgc29ydE9ic2VydmFibGUoKTogU3ViamVjdDxhbnk+IHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc29ydE9ic2VydmFibGU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBzb3J0UGFyYW1zKCk6IHN0cmluZ1tdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc29ydFBhcmFtcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IHNvcnREaXJzKCk6IHN0cmluZ1tdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fc29ydERpcnM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBjb2x1bW5zKCk6IHsgaWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBpc0FjdGl2ZT86IGJvb2xlYW4gfVtdIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29sdW1ucy52YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IHBhZ2VTaXplT3B0aW9ucygpOiBudW1iZXJbXSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BhZ2VTaXplT3B0aW9ucztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgc2V0IHNvcnRQYXJhbXModjogc3RyaW5nW10pIHtcclxuICAgICAgICB0aGlzLl9zb3J0UGFyYW1zID0gdjtcclxuICAgICAgICB0aGlzLl9kYXRhU291cmNlLnNvcnQuYWN0aXZlcyA9IHRoaXMuX3NvcnRQYXJhbXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHNldCBzb3J0RGlycyh2OiBzdHJpbmdbXSkge1xyXG4gICAgICAgIHRoaXMuX3NvcnREaXJzID0gdjtcclxuICAgICAgICB0aGlzLl9kYXRhU291cmNlLnNvcnQuZGlyZWN0aW9ucyA9IHRoaXMuX3NvcnREaXJzLm1hcChlbGVtID0+IGVsZW0gYXMgU29ydERpcmVjdGlvbik7XHJcbiAgICB9XHJcbn1cclxuIl19